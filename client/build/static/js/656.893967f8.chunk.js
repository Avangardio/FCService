"use strict";(self.webpackChunkCLient_app=self.webpackChunkCLient_app||[]).push([[656],{9656:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var n=a(885),s=a(8203),r=a(2791),i=a(9434),l=a(6501),u=a(5107),c=a(4805),o=a(9085),d=a(184),m=l.P.instance.socket;function f(){var e=(0,i.I0)(),t=(0,i.v9)((function(e){return e.feedState.feedElements.chats})),a=(0,i.v9)((function(e){return e.userState.uId})),l=(0,c.useMediaQuery)({query:"(min-width: 500px)"}),f=(0,u.useQueryParam)("chat",u.StringParam),h=(0,n.Z)(f,2),g=h[0],C=(h[1],(0,r.useState)("")),v=(0,n.Z)(C,2),p=v[0],x=v[1],N=(0,r.useState)(!1),j=(0,n.Z)(N,2),I=j[0],S=j[1],A=(0,r.useState)(""),_=(0,n.Z)(A,2),E=_[0],P=_[1],O=(0,r.useRef)(null),H=[g,a].sort().join(""),y=t[H],T=t[H]?t[H].messages:null,b=y?Object.keys(y.chatProfiles).map((function(e){return y.chatProfiles[e]})):null;if((0,r.useEffect)((function(){if(a)return y||m.emit("LOAD_NEW_CHAT",{uId:a,pageId:g}),m.on("LOAD_NEW_CHAT_ANSWER",(function(a){console.log(a),e(s.Z.loadNewChat(a)),console.log(t)})),m.on("UPLOAD_PHOTO_ANSWER",(function(e){P(e)})),function(){m.off("LOAD_NEW_CHAT_ANSWER"),m.off("UPLOAD_PHOTO_ANSWER")}}),[g]),(0,r.useEffect)((function(){T&&a&&0!==T.length&&(m.emit("READ_CHAT_MESSAGES",{chatId:H,to:T[0].messageId,host:a}),e(s.Z.markAsRead(H,g)))}),[null===T||void 0===T?void 0:T.length]),(0,r.useEffect)((function(){if(t&&0!==Object.entries(t).length&&!I){var e=O.current;e&&e.scrollIntoView(),S(!0)}}),[t,I]),!y||!a)return(0,d.jsx)("div",{children:"Loading..."});var D=null===b||void 0===b?void 0:b.find((function(e){return e.uId===g})),L=null===T||void 0===T?void 0:T.map((function(e,t,a){if(e){var n=t>0?a[t-1]:null,s=t<a.length-1?a[t+1]:null,r=e.messageId,i=e.body,l=e.from,u=(e.chatId,e.contentType,e.unRead),c=e.picture,o=null===b||void 0===b?void 0:b.find((function(e){return e.uId===l})),m=l===(null===n||void 0===n?void 0:n.from),f=l===(null===s||void 0===s?void 0:s.from),h="ChatMessage";return m&&(h+=" NextMessage"),f&&(h+=" NextMessageSame"),f||(h+=" NextMessageNew"),u&&(h+=" Unread"),(0,d.jsxs)("div",{className:h,children:[m||(0,d.jsx)("div",{children:(0,d.jsx)("img",{className:"ChatHeaderImage",src:o.profilePhoto,alt:"missing"})}),(0,d.jsxs)("div",{className:m?"ChatHeaderContainer NextMessage":"ChatHeaderContainer",children:[m||(0,d.jsx)("span",{className:"ChatHeaderTitle",children:o.firstName}),(0,d.jsx)("span",{className:"ChatUserText",children:i}),c?(0,d.jsx)("img",{className:"CurrenChatPicture",src:c}):null]},r)]})}}));return D?(0,d.jsxs)("div",{className:l?"CurrentChat":"CurrentChat Mobile",children:[(0,d.jsxs)("div",{className:"CurrentChatHeader",children:[(0,d.jsx)("span",{className:"ChatHeaderTitle",children:D.firstName+" "+D.lastName}),(0,d.jsx)("img",{className:"ChatHeaderImage",src:D.profilePhoto,alt:"missing"})]}),(0,d.jsx)("div",{className:"",children:(0,d.jsxs)("div",{className:"ChatMessagesContainer",children:[L,(0,d.jsx)("div",{ref:O})]})}),(0,d.jsxs)("form",{className:"CurrentChatForm",onSubmit:function(n){n.preventDefault();var r=t[H].messages.slice(-1)[0],i=t[H].chatProfiles,l=r?r.messageId+1:1,u={body:p||" ",from:a,messageId:l,currentChat:H,contentType:E?"picture":"text",date:new Date(Date.now()).toISOString(),chatUsers:b.map((function(e){return e.uId})).sort(),picture:E||void 0,unRead:!0};e(s.Z.newMessage(H,u,i)),m.emit("SEND_MESSAGE",{senderId:a,chatId:H,message:u,chatProfiles:i}),S(!1),x(""),P("")},children:[(0,d.jsx)("textarea",{placeholder:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",value:p,style:{resize:"none"},onChange:function(e){return x(e.target.value)}}),(0,d.jsx)("input",{type:"file",onChange:function(e){var t=e.target.files[0];t.size<4194304?m.emit("UPLOAD_PHOTO",t,t.name):o.Am.error("\u0424\u0430\u0439\u043b \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0431\u043e\u043b\u044c\u0448\u043e\u0439!")},accept:"image/png, image/jpeg",id:"ChatImageLoad"}),(0,d.jsx)("input",{type:"button",onClick:function(){return document.querySelector("#ChatImageLoad").click()}}),(0,d.jsx)("div",{children:E?(0,d.jsx)("img",{className:"ChatImagePreview",src:E}):null}),(0,d.jsx)("button",{type:"submit"})]})]}):(0,d.jsx)("div",{children:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442"})}}}]);
//# sourceMappingURL=656.893967f8.chunk.js.map